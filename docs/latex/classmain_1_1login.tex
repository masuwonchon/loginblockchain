\hypertarget{classmain_1_1login}{}\section{main.\+login Class Reference}
\label{classmain_1_1login}\index{main.\+login@{main.\+login}}


Inheritance diagram for main.\+login\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=146pt]{classmain_1_1login__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for main.\+login\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=146pt]{classmain_1_1login__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classmain_1_1login_a842b5fefc13556cbae749a8dc58d8e31}{get} (self)
\item 
def \hyperlink{classmain_1_1login_a71ff3f89aaf0f0c8502577445ab38744}{post} (self)
\end{DoxyCompactItemize}


\subsection{Detailed Description}


Definition at line 160 of file main.\+py.



\subsection{Member Function Documentation}
\index{main\+::login@{main\+::login}!get@{get}}
\index{get@{get}!main\+::login@{main\+::login}}
\subsubsection[{\texorpdfstring{get(self)}{get(self)}}]{\setlength{\rightskip}{0pt plus 5cm}def main.\+login.\+get (
\begin{DoxyParamCaption}
\item[{}]{self}
\end{DoxyParamCaption}
)}\hypertarget{classmain_1_1login_a842b5fefc13556cbae749a8dc58d8e31}{}\label{classmain_1_1login_a842b5fefc13556cbae749a8dc58d8e31}


Definition at line 161 of file main.\+py.


\begin{DoxyCode}
161     \textcolor{keyword}{def }\hyperlink{classmain_1_1login_a842b5fefc13556cbae749a8dc58d8e31}{get}(self):
162         \textcolor{keywordflow}{if} current\_user.is\_authenticated:
163             \textcolor{keywordflow}{return} redirect(url\_for(\textcolor{stringliteral}{'index'}))
164 
165         response = make\_response(render\_template(\textcolor{stringliteral}{'login.html'}))
166 
167         \textcolor{keywordflow}{return} response
168 
\end{DoxyCode}
\index{main\+::login@{main\+::login}!post@{post}}
\index{post@{post}!main\+::login@{main\+::login}}
\subsubsection[{\texorpdfstring{post(self)}{post(self)}}]{\setlength{\rightskip}{0pt plus 5cm}def main.\+login.\+post (
\begin{DoxyParamCaption}
\item[{}]{self}
\end{DoxyParamCaption}
)}\hypertarget{classmain_1_1login_a71ff3f89aaf0f0c8502577445ab38744}{}\label{classmain_1_1login_a71ff3f89aaf0f0c8502577445ab38744}


Definition at line 169 of file main.\+py.


\begin{DoxyCode}
169     \textcolor{keyword}{def }\hyperlink{classmain_1_1login_a71ff3f89aaf0f0c8502577445ab38744}{post}(self):
170         username = request.form.get(\textcolor{stringliteral}{'username'})
171         password = request.form.get(\textcolor{stringliteral}{'password'})
172         token = request.form.get(\textcolor{stringliteral}{'token'})
173         prev\_LHB = request.form.get(\textcolor{stringliteral}{'loginhashblock'})
174 
175         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} username:
176             flash(\textcolor{stringliteral}{'username is null'})
177             \textcolor{keywordflow}{return} make\_response(\textcolor{stringliteral}{'Error'}, 302)
178 
179         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} password:
180             flash(\textcolor{stringliteral}{'password is null'})
181             \textcolor{keywordflow}{return} make\_response(\textcolor{stringliteral}{'Error'}, 302)
182 
183         user = User.query.filter\_by(username=username).first()
184 
185         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} user:
186             flash(\textcolor{stringliteral}{'not registered username'})
187             \textcolor{keywordflow}{return} make\_response(\textcolor{stringliteral}{'Error'}, 302)
188 
189         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} user.verify\_password(password):
190             flash(\textcolor{stringliteral}{'password was wrong'})
191             \textcolor{keywordflow}{return} make\_response(\textcolor{stringliteral}{'Error'}, 302)
192 
193         \textcolor{keywordflow}{if} token:
194             \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} user.verify\_totp(token):
195                 flash(\textcolor{stringliteral}{'OTP was wrong'})
196                 \textcolor{keywordflow}{return} make\_response(\textcolor{stringliteral}{'Error'}, 302)
197 
198             \textcolor{keywordflow}{if} prev\_LHB == \textcolor{stringliteral}{'null'}:
199                 prev\_LHB = \textcolor{keywordtype}{None}
200 
201             \textcolor{keywordflow}{if} prev\_LHB:
202                 \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} \hyperlink{namespaceloginhashblock_adb424539d851426da7b65d53c5a6d577}{valid\_loginhashblock}(prev\_LHB):
203                     flash(\textcolor{stringliteral}{'Your account is suspected of being stolen. OTP is required.'})
204                     \textcolor{keywordflow}{return} make\_response(\textcolor{stringliteral}{'Error'}, 302)
205 
206                 LHBlistStr, new\_LHB = \hyperlink{namespaceloginhashblock_a2bcc7ddd0fcc3788572dd77808cb624d}{update\_loginhashblocklist}(user.Lhashblock, 
      prev\_LHB, DEBUG=DEBUG)
207             \textcolor{keywordflow}{else}:
208                 LHBlistStr, new\_LHB = \hyperlink{namespaceloginhashblock_a550707107141dfb228ca4294d7ea31b4}{create\_loginhashblocklist}(user.Lhashblock, 
      DEBUG=DEBUG)
209         \textcolor{keywordflow}{else}:
210             \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} user.Lhashblock:
211                 flash(\textcolor{stringliteral}{'Your account is first login, OTP is required.'})
212                 \textcolor{keywordflow}{return} make\_response(\textcolor{stringliteral}{'Error'}, 302)
213 
214             \textcolor{keywordflow}{if} prev\_LHB:
215                 \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} \hyperlink{namespaceloginhashblock_adb424539d851426da7b65d53c5a6d577}{valid\_loginhashblock}(prev\_LHB):
216                     flash(\textcolor{stringliteral}{'Your account is suspected of being stolen. OTP is required.'})
217                     print(\textcolor{stringliteral}{"Error valid\_loginhashblock"})
218                     \textcolor{keywordflow}{return} make\_response(\textcolor{stringliteral}{'Error'}, 302)
219 
220                 \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} \hyperlink{namespaceloginhashblock_aa5bb94484a68d0bbebce23b4cfeeb4b7}{verify\_loginhashblock}(user.Lhashblock, prev\_LHB):
221                     flash(\textcolor{stringliteral}{'Your account is suspected of being stolen. OTP is required.'})
222                     print(\textcolor{stringliteral}{"Error verify\_loginhashblock"})
223                     \textcolor{keywordflow}{return} make\_response(\textcolor{stringliteral}{'Error'}, 302)
224 
225                 LHBlistStr, new\_LHB = \hyperlink{namespaceloginhashblock_a2bcc7ddd0fcc3788572dd77808cb624d}{update\_loginhashblocklist}(user.Lhashblock, 
      prev\_LHB, DEBUG=DEBUG)
226             \textcolor{keywordflow}{else}:
227                 flash(\textcolor{stringliteral}{'Error! Debug Mode'})
228                 \textcolor{keywordflow}{return} make\_response(\textcolor{stringliteral}{'Error'}, 302)
229 
230         user.Lhashblock = LHBlistStr
231         db.session.commit()
232 
233         \textcolor{keywordflow}{if} DEBUG:
234             text = \textcolor{stringliteral}{"[info:login:post]\(\backslash\)nprev\_hashblock[\{\}]: \{\}\(\backslash\)nnext\_hashblock[\{\}]: \{\}"}.format(username,
      prev\_LHB,username,new\_LHB)
235             print(text)
236 
237         login\_user(user)
238         flash(\textcolor{stringliteral}{'You are now logged in!'})
239         condition = \textcolor{keyword}{True}
240         response = make\_response(render\_template(\textcolor{stringliteral}{'index.html'}, condition=condition, username=username, 
      LoginHB=new\_LHB))
241         \textcolor{keywordflow}{return} response
242 
\end{DoxyCode}


Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classmain_1_1login_a71ff3f89aaf0f0c8502577445ab38744_cgraph}
\end{center}
\end{figure}




The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
example/\hyperlink{main_8py}{main.\+py}\end{DoxyCompactItemize}
