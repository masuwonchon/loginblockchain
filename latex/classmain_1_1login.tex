\hypertarget{classmain_1_1login}{}\section{main.\+login Class Reference}
\label{classmain_1_1login}\index{main.\+login@{main.\+login}}


Inheritance diagram for main.\+login\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=146pt]{classmain_1_1login__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for main.\+login\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=146pt]{classmain_1_1login__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classmain_1_1login_a842b5fefc13556cbae749a8dc58d8e31}{get} (self)
\item 
def \hyperlink{classmain_1_1login_a71ff3f89aaf0f0c8502577445ab38744}{post} (self)
\end{DoxyCompactItemize}


\subsection{Detailed Description}


Definition at line 157 of file main.\+py.



\subsection{Member Function Documentation}
\index{main\+::login@{main\+::login}!get@{get}}
\index{get@{get}!main\+::login@{main\+::login}}
\subsubsection[{\texorpdfstring{get(self)}{get(self)}}]{\setlength{\rightskip}{0pt plus 5cm}def main.\+login.\+get (
\begin{DoxyParamCaption}
\item[{}]{self}
\end{DoxyParamCaption}
)}\hypertarget{classmain_1_1login_a842b5fefc13556cbae749a8dc58d8e31}{}\label{classmain_1_1login_a842b5fefc13556cbae749a8dc58d8e31}


Definition at line 158 of file main.\+py.


\begin{DoxyCode}
158     \textcolor{keyword}{def }\hyperlink{classmain_1_1login_a842b5fefc13556cbae749a8dc58d8e31}{get}(self):
159         \textcolor{keywordflow}{if} current\_user.is\_authenticated:
160             \textcolor{keywordflow}{return} redirect(url\_for(\textcolor{stringliteral}{'index'}))
161 
162         response = make\_response(render\_template(\textcolor{stringliteral}{'login.html'}))
163 
164         \textcolor{keywordflow}{return} response
165 
\end{DoxyCode}
\index{main\+::login@{main\+::login}!post@{post}}
\index{post@{post}!main\+::login@{main\+::login}}
\subsubsection[{\texorpdfstring{post(self)}{post(self)}}]{\setlength{\rightskip}{0pt plus 5cm}def main.\+login.\+post (
\begin{DoxyParamCaption}
\item[{}]{self}
\end{DoxyParamCaption}
)}\hypertarget{classmain_1_1login_a71ff3f89aaf0f0c8502577445ab38744}{}\label{classmain_1_1login_a71ff3f89aaf0f0c8502577445ab38744}


Definition at line 166 of file main.\+py.


\begin{DoxyCode}
166     \textcolor{keyword}{def }\hyperlink{classmain_1_1login_a71ff3f89aaf0f0c8502577445ab38744}{post}(self):
167         username = request.form.get(\textcolor{stringliteral}{'username'})
168         password = request.form.get(\textcolor{stringliteral}{'password'})
169         token = request.form.get(\textcolor{stringliteral}{'token'})
170         prev\_LHB = request.form.get(\textcolor{stringliteral}{'loginhashblock'})
171 
172         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} username:
173             flash(\textcolor{stringliteral}{'username is null'})
174             \textcolor{keywordflow}{return} make\_response(\textcolor{stringliteral}{'Error'}, 302)
175 
176         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} password:
177             flash(\textcolor{stringliteral}{'password is null'})
178             \textcolor{keywordflow}{return} make\_response(\textcolor{stringliteral}{'Error'}, 302)
179 
180         user = User.query.filter\_by(username=username).first()
181 
182         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} user:
183             flash(\textcolor{stringliteral}{'not registered username'})
184             \textcolor{keywordflow}{return} make\_response(\textcolor{stringliteral}{'Error'}, 302)
185 
186         \textcolor{stringliteral}{'''}
187 \textcolor{stringliteral}{        if DEBUG:}
188 \textcolor{stringliteral}{            print\_LHBlist(user.Lhashblock)}
189 \textcolor{stringliteral}{        '''}
190 
191         \textcolor{keywordflow}{if} prev\_LHB == \textcolor{stringliteral}{'null'}:
192             prev\_LHB = \textcolor{keywordtype}{None}
193 
194         \textcolor{keywordflow}{if} user.verify\_password(password) \textcolor{keywordflow}{and} user.verify\_totp(token):
195             LHBlistStr = \hyperlink{namespaceloginhashblock_ab3608ba58ffedb0bd8bba86ce71fdefe}{create\_loginhashblocklist}(user.Lhashblock, DEBUG=DEBUG):
196             user.Lhashblock = LHBlistStr
197             db.session.commit()
198         \textcolor{keywordflow}{elif} \textcolor{keywordflow}{not} prev\_LHB:
199             \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} user.verify\_password(password) \textcolor{keywordflow}{or} \textcolor{keywordflow}{not} user.verify\_totp(token):
200                 print(\textcolor{stringliteral}{'[info:login:post] Invalid username, password or OTP token'})
201                 flash(\textcolor{stringliteral}{'Your account is suspected of being stolen. OTP is required.'})
202                 \textcolor{keywordflow}{return} make\_response(\textcolor{stringliteral}{'Error'}, 302)
203         \textcolor{keywordflow}{elif} prev\_LHB:
204             \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} user.verify\_password(password):
205                 flash(\textcolor{stringliteral}{'your password is wrong'})
206                 \textcolor{keywordflow}{return} make\_response(\textcolor{stringliteral}{'Error'}, 302)
207             \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} \hyperlink{namespaceloginhashblock_ac120dd8384bd51c357e2ad5f6cb2f99a}{valid\_loginhashblock}(prev\_LHB):
208                 flash(\textcolor{stringliteral}{'Your account is suspected of being stolen. OTP is required.'})
209                 \textcolor{keywordflow}{return} make\_response(\textcolor{stringliteral}{'Error'}, 302)
210             \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} \hyperlink{namespaceloginhashblock_a978cb4557443cefddac883f3d92ad8e1}{isRegistedLHB}(prev\_LHB, user.Lhashblock, DEBUG=DEBUG):
211                 flash(\textcolor{stringliteral}{'Your account is suspected of being stolen. OTP is required.'})
212                 \textcolor{keywordflow}{return} make\_response(\textcolor{stringliteral}{'Error'}, 302)
213 
214             LHBlistStr = \hyperlink{namespaceloginhashblock_a7baa4021b9f57044f8227c2e0320ee2b}{update\_loginhashblocklist}(user.Lhashblock, prev\_LHB, 
      DEBUG=DEBUG)
215             user.Lhashblock = LHBlistStr
216             db.session.commit()
217         \textcolor{keywordflow}{else}:
218             text = \textcolor{stringliteral}{'[error:login:post] other case'}
219             print(text)
220             \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"[error:login:post] exit"})
221 
222 
223         \textcolor{keywordflow}{if} DEBUG:
224             text = \textcolor{stringliteral}{"[info:login:post]\(\backslash\)nprev\_hashblock[\{\}]: \{\}\(\backslash\)nnext\_hashblock[\{\}]: \{\}"}.format(username,
      prev\_LHB,username,new\_LHB)
225             print(text)
226 
227         login\_user(user)
228         flash(\textcolor{stringliteral}{'You are now logged in!'})
229         condition = \textcolor{keyword}{True}
230         response = make\_response(render\_template(\textcolor{stringliteral}{'index.html'}, condition=condition, username=username, 
      LoginHB=new\_LHB))
231         \textcolor{keywordflow}{return} response
232 
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classmain_1_1login_a71ff3f89aaf0f0c8502577445ab38744_cgraph}
\end{center}
\end{figure}




The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
example/\hyperlink{main_8py}{main.\+py}\end{DoxyCompactItemize}
